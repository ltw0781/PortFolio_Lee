<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace="매퍼 인터페이스 경로" --> 
<mapper namespace="com.port.folio.user.mapper.UserMapper">

    <resultMap id="UserMap" type="Users">                       <!-- PK값 -->

        <id property="no" column="no" />

        <result property="no" column="no" />
        <result property="username" column="username" />
        <result property="password" column="password" />
        <result property="name" column="name" />
        <result property="email" column="email" />
        <result property="address" column="address" />
        <result property="phone" column="phone" />
        <result property="enabled" column="enabled" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
        
        <collection property="authList" resultMap="AuthMap">



        </collection>

    </resultMap>

    <resultMap id="AuthMap" type="UserAuth">

        <result property="no" column="no" />
        <result property="username" column="username" />
        <result property="auth" column="auth" />

    </resultMap>

    <!-- 회원가입  -->
    <insert id="join">
        INSERT INTO users ( username, password, name, email )
        VALUES ( #{username}, #{password} ,#{name}, #{email} )
    </insert>

        <!-- 회원 권한 등록  -->
    <insert id="insertAuth">
        INSERT INTO user_auth ( username, auth )
        VALUES ( #{username}, #{auth} )
    </insert>

    <!-- 회원 조회 -->
    <select id="select" resultMap="UserMap">
        SELECT u.*
              ,auth
        FROM users u
             LEFT JOIN user_auth auth ON u.username = auth.username
        WHERE u.username = #{username}
    </select>


    <!-- 아이디 중복 확인 -->
    <select id="existsByUsername">
        SELECT COUNT(*) 
        FROM users
        WHERE username = #{username}
    </select>

</mapper>